<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CubeZilla Solver</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
<style>
:root {
  --bg-main: #020617;
  --bg-panel: #0b1120;
  --bg-glass: rgba(15, 23, 42, 0.92);
  --accent-primary: #6366f1;
  --accent-glow: #8b5cf6;
  --accent-soft: #a5b4fc;
  --text-main: #e5e7eb;
  --text-muted: #9ca3af;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  width: 100%; height: 100vh; background:
    radial-gradient(ellipse at top left, rgba(99,102,241,0.18) 0%, transparent 55%),
    radial-gradient(ellipse at bottom right, rgba(139,92,246,0.16) 0%, transparent 55%),
    #020617;
  font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
  color: var(--text-main);
  overflow: hidden;
  touch-action: none;
}
#overlay,#main-app,#tutorial-modal { position: fixed; inset: 0; }
#overlay { display: flex; justify-content: center; align-items: center; z-index: 100;
  background: radial-gradient(circle at 10% 10%, rgba(79,70,229,0.35) 0%, transparent 45%),
              radial-gradient(circle at 90% 90%, rgba(147,51,234,0.3) 0%, transparent 45%),
              rgba(2,6,23,0.96); }
.page { padding: 40px 44px 32px; max-width: 480px; width: 90vw; background: linear-gradient(145deg, rgba(15,23,42,0.96), rgba(15,23,42,0.92));
  border-radius: 26px; border: 1px solid rgba(148,163,184,0.4); box-shadow: 0 30px 80px rgba(15,23,42,0.9), 0 0 40px rgba(79,70,229,0.4); }
.page h1 { font-size: 2.1rem; margin-bottom: 12px; background: linear-gradient(135deg, #e5e7eb, #a5b4fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.pop-btn { padding: 12px 26px; background: linear-gradient(135deg, var(--accent-primary), var(--accent-glow)); color: white; border: none; border-radius: 999px;
  cursor: pointer; font-weight: 600; font-size: 0.95rem; letter-spacing: 0.05em; text-transform: uppercase; box-shadow: 0 18px 40px rgba(59,130,246,0.45); transition: all 0.2s; }
.pop-btn:hover { transform: translateY(-2px) scale(1.02); box-shadow: 0 24px 55px rgba(79,70,229,0.6); }
#main-app { display: none; height: 100vh; grid-template-columns: 300px 1fr; }
#sidebar { background: #020617; border-right: 1px solid rgba(15,23,42,1); padding: 22px 20px; display: flex; flex-direction: column; gap: 16px; box-shadow: 10px 0 40px rgba(0,0,0,0.6); }
#solve-info { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); padding: 8px 18px; background: rgba(15,23,42,0.95); border-radius: 999px;
  border: 1px solid rgba(148,163,184,0.6); color: var(--text-muted); font-size: 0.8rem; opacity: 0; transition: opacity 0.3s; z-index: 10; }
.camera-column { position: absolute; top: 50%; left: 24px; transform: translateY(-50%); display: flex; flex-direction: column; gap: 12px; }
.camera-btn { width: 46px; height: 46px; background: #111827; color: #e5e7eb; border-radius: 14px; border: 1px solid rgba(75,85,99,0.9); cursor: pointer; font-weight: 600; }
.move-bar { position: absolute; bottom: 34px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; padding: 14px 16px; background: rgba(15,23,42,0.98);
  border-radius: 18px; border: 1px solid rgba(51,65,85,0.9); }
.move-btn { padding: 8px 10px; min-width: 40px; background: #0f172a; color: #e5e7eb; border-radius: 10px; border: 1px solid rgba(55,65,81,0.9); cursor: pointer; font-size: 0.8rem; text-transform: uppercase; }
#color-picker .color-btn { width: 42px; height: 42px; border-radius: 12px; border: 3px solid transparent; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 12px rgba(0,0,0,0.4); }
#color-picker .color-btn.active { border: 3px solid var(--accent-soft); transform: scale(1.15); box-shadow: 0 0 20px rgba(165,180,252,0.6); }
.tool-btn { padding: 8px 16px; background: rgba(15,23,42,0.8); color: white; border: 1px solid rgba(75,85,99,0.8); border-radius: 10px; cursor: pointer; font-size: 0.85rem; font-weight: 600; transition: all 0.2s; }
.tool-btn.active { background: var(--accent-primary); border-color: var(--accent-glow); box-shadow: 0 0 15px rgba(99,102,241,0.5); }
.tool-btn.small { padding: 6px 12px; font-size: 0.8rem; }
#paint-palette-header { cursor: pointer; user-select: none; padding: 12px 24px; background: rgba(15,23,42,0.95); border-bottom: 1px solid rgba(148,163,184,0.2);
  font-weight: bold; font-size: 0.9rem; color: var(--accent-soft); letter-spacing: 0.1em; display: flex; justify-content: space-between; align-items: center; }
#paint-palette-content { transition: max-height 0.4s ease, opacity 0.3s ease, padding 0.4s ease; max-height: 800px; opacity: 1; overflow: hidden; }
#paint-palette-content.collapsed { max-height: 0; opacity: 0; padding: 0 24px !important; }
</style>
</head>
<body>
<div id="overlay">
  <div class="page">
    <h1>CubeZilla Solver</h1>
    <p>A cinematic 3D Rubik’s cube that records every move you make and can rewind the entire scramble on command.</p>
    <p style="margin-bottom:22px;">Learn how a solver “thinks” through CFOP-style phases while you experiment with your own scrambles.</p>
    <div style="display:flex; flex-direction:column; gap:12px; margin-bottom:26px;">
      <button class="pop-btn" onclick="startSolver()">Solve a scramble</button>
      <button class="pop-btn" style="background:#0f172a; border:1px solid rgba(148,163,184,0.5); color:#e5e7eb;" onclick="showHowItWorks()">? How does the app work?</button>
      <button class="pop-btn" style="background:linear-gradient(135deg,#22c55e,#16a34a); box-shadow:0 18px 40px rgba(34,197,94,0.4);" onclick="startSolver()">Free-play with the cube</button>
      <button class="pop-btn" onclick="startPaintMode()">Paint Mode</button>
    </div>
    <div style="margin-top:10px; padding-top:10px; border-top:1px solid rgba(55,65,81,0.7); display:flex; justify-content:space-between; font-size:0.8rem; color:#9ca3af;">
      <span>Credits: Anirudh · Madhav · Pratik</span>
      <span>v1.0 · experimental</span>
    </div>
  </div>
</div>

<div id="main-app">
  <div id="sidebar">
    <h2 id="method-title">CONTROLS</h2>
    <button class="pop-btn" onclick="scramble()">Scramble</button>
    <button class="pop-btn" onclick="solveCube()">Solve</button>
    <button class="pop-btn" onclick="resetCube()">Reset Cube</button>
    <button class="pop-btn" onclick="resetView()">Reset View</button>
    <button class="pop-btn" style="background:linear-gradient(135deg,#a855f7,#c084fc);" onclick="openTutorial()">Learn to Solve</button>
    <button class="pop-btn" style="background:#374151" onclick="backToMenu()">Back to menu</button>
  </div>
  <div id="cube-container">
    <div id="solve-info"></div>
    <div class="camera-column">
      <button class="camera-btn" onclick="snapAndReorient('front')">F</button>
      <button class="camera-btn" onclick="snapAndReorient('right')">R</button>
      <button class="camera-btn" onclick="snapAndReorient('back')">B</button>
      <button class="camera-btn" onclick="snapAndReorient('left')">L</button>
      <button class="camera-btn" onclick="snapAndReorient('up')">U</button>
      <button class="camera-btn" onclick="snapAndReorient('down')">D</button>
    </div>
    <div class="move-bar">
      <button class="move-btn" onclick="screenMove('R')">R</button>
      <button class="move-btn" onclick="screenMove('R_prime')">R'</button>
      <button class="move-btn" onclick="screenMove('L')">L</button>
      <button class="move-btn" onclick="screenMove('L_prime')">L'</button>
      <button class="move-btn" onclick="screenMove('U')">U</button>
      <button class="move-btn" onclick="screenMove('U_prime')">U'</button>
      <button class="move-btn" onclick="screenMove('F')">F</button>
      <button class="move-btn" onclick="screenMove('F_prime')">F'</button>
    </div>

    <!-- Paint Palette (minimizable) -->
    <div id="paint-palette" style="position:absolute; bottom:90px; right:40px; display:none;">
      <div style="background:var(--bg-glass); border-radius:20px; border:1px solid rgba(148,163,184,0.3); backdrop-filter:blur(12px); box-shadow:0 20px 40px rgba(0,0,0,0.6); overflow:hidden;">
        <div id="paint-palette-header" onclick="document.getElementById('paint-palette-content').classList.toggle('collapsed'); document.getElementById('palette-toggle').textContent = document.getElementById('paint-palette-content').classList.contains('collapsed')?'Plus':'Minus';">
          PAINT TOOLS <span id="palette-toggle">Minus</span>
        </div>
        <div id="paint-palette-content">
          <div style="padding:20px 24px;">
            <div id="color-picker" style="display:flex; justify-content:center; gap:10px; margin-bottom:16px; flex-wrap:wrap;">
              <button class="color-btn active" data-color="0xffffff" style="background:#ffffff;"></button>
              <button class="color-btn" data-color="0xffff00" style="background:#facc15;"></button>
              <button class="color-btn" data-color="0xff0000" style="background:#ef4444;"></button>
              <button class="color-btn" data-color="0xffa500" style="background:#f97316;"></button>
              <button class="color-btn" data-color="0x00ff00" style="background:#22c55e;"></button>
              <button class="color-btn" data-color="0x0000ff" style="background:#3b82f6;"></button>
            </div>
            <div style="display:flex; justify-content:center; gap:12px; margin-bottom:16px;">
              <button id="tool-brush" class="tool-btn active">Brush</button>
              <button id="tool-eraser" class="tool-btn">Eraser</button>
            </div>
            <div style="display:flex; justify-content:center; gap:12px;">
              <button id="undo-btn" class="tool-btn small" disabled>Undo</button>
              <button id="redo-btn" class="tool-btn small" disabled>Redo</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
let scene, camera, renderer, cubies=[], cubeGroup, inputCubeGroup, inputCubies=[];
let moveHistory=[], paintMode=false, currentPaintColor=0xffffff, currentPaintTool="brush";
let paintHistory=[], historyIndex=-1;
const originalInputColors = {0:0xff0000,1:0xffa500,2:0xffffff,3:0xffff00,4:0x00ff00,5:0x0000ff};
let isRotating=false, isChangingView=false, currentView={theta:0,phi:0.3}, zoomDistance=12;
let isDragging=false, previousMouseX=0, previousMouseY=0, rotationSpeed=0.005;
let lastPaintedKey=null;
const raycaster=new THREE.Raycaster(), mouse=new THREE.Vector2();

function setSolveInfo(t){const e=document.getElementById('solve-info');if(e){e.textContent=t||'';e.style.opacity=t?1:0;}}
function startSolver(){document.getElementById('overlay').style.display='none';document.getElementById('main-app').style.display='grid';setup3D();}
function startPaintMode(){
  if(!scene)startSolver();
  paintMode=true;cubeGroup.visible=false;inputCubeGroup.visible=true;
  document.getElementById('paint-palette').style.display='block';
  gsap.to(inputCubeGroup.position,{x:0,y:0,z:0,duration:0.8,ease:"power2.out"});
  paintHistory=[];historyIndex=-1;savePaintState();
}
function savePaintState(){
  const state=inputCubies.map(c=>c.material.map(m=>m.color.getHex()));
  paintHistory=paintHistory.slice(0,historyIndex+1);paintHistory.push(state);historyIndex++;
  document.getElementById("undo-btn").disabled=historyIndex<=0;
  document.getElementById("redo-btn").disabled=historyIndex>=paintHistory.length-1;
}
function applyPaintState(state){
  state.forEach((colors,i)=>colors.forEach((c,j)=>inputCubies[i].material[j].color.setHex(c)));
  renderer.render(scene,camera);
}
function onPointerDown(e){
  lastPaintedKey=null;
  if(paintMode){
    const r=renderer.domElement.getBoundingClientRect();
    mouse.x=((e.clientX||e.touches[0].clientX)-r.left)/r.width*2-1;
    mouse.y=-((e.clientY||e.touches[0].clientY)-r.top)/r.height*2+1;
    raycaster.setFromCamera(mouse,camera);
    const hits=raycaster.intersectObjects(inputCubies,false);
    if(hits.length>0){
      const face=Math.floor(hits[0].faceIndex/2);
      const key=hits[0].object.uuid+face;
      lastPaintedKey=key;
      hits[0].object.material[face].color.setHex(currentPaintTool==="eraser"?originalInputColors[face]:currentPaintColor);
    }
    isDragging=true;return;
  }
  isDragging=true;previousMouseX=e.clientX||e.touches[0].clientX;previousMouseY=e.clientY||e.touches[0].clientY;
}
function onPointerMove(e){
  if(!isDragging||isRotating||isChangingView)return;
  if(paintMode){
    const r=renderer.domElement.getBoundingClientRect();
    mouse.x=((e.clientX||e.touches[0].clientX)-r.left)/r.width*2-1;
    mouse.y=-((e.clientY||e.touches[0].clientY)-r.top)/r.height*2+1;
    raycaster.setFromCamera(mouse,camera);
    const hits=raycaster.intersectObjects(inputCubies,false);
    if(hits.length>0){
      const face=Math.floor(hits[0].faceIndex/2);
      const key=hits[0].object.uuid+face;
      if(key===lastPaintedKey)return;
      lastPaintedKey=key;
      hits[0].object.material[face].color.setHex(currentPaintTool==="eraser"?originalInputColors[face]:currentPaintColor);
    }
    return;
  }
  const dx=(e.clientX||e.touches[0].clientX)-previousMouseX;
  const dy=(e.clientY||e.touches[0].clientY)-previousMouseY;
  currentView.theta-=dx*rotationSpeed;currentView.phi-=dy*rotationSpeed;
  currentView.phi=Math.max(0.1,Math.min(Math.PI-0.1,currentView.phi));
  camera.position.set(zoomDistance*Math.cos(currentView.phi)*Math.sin(currentView.theta),
                      zoomDistance*Math.sin(currentView.phi),
                      zoomDistance*Math.cos(currentView.phi)*Math.cos(currentView.theta));
  camera.lookAt(0,0,0);previousMouseX=e.clientX||e.touches[0].clientX;previousMouseY=e.clientY||e.touches[0].clientY;
}
function onPointerUp(){if(paintMode&&isDragging)savePaintState();isDragging=false;lastPaintedKey=null;}
// ... (rest of your original functions: setup3D, snapAndReorient, screenMove, handleMove, scramble, solveCube, resetCube, resetView, animate, etc. — unchanged)

// Paint tools
document.querySelectorAll(".color-btn").forEach(b=>b.addEventListener("click",()=>{document.querySelectorAll(".color-btn").forEach(x=>x.classList.remove("active"));b.classList.add("active");currentPaintColor=parseInt(b.dataset.color,16);currentPaintTool="brush";document.getElementById("tool-brush").classList.add("active");document.getElementById("tool-eraser").classList.remove("active");}));
document.getElementById("tool-brush").onclick=()=>{currentPaintTool="brush";document.getElementById("tool-brush").classList.add("active");document.getElementById("tool-eraser").classList.remove("active");};
document.getElementById("tool-eraser").onclick=()=>{currentPaintTool="eraser";document.getElementById("tool-eraser").classList.add("active");document.getElementById("tool-brush").classList.remove("active");};
document.getElementById("undo-btn").onclick=()=>{if(historyIndex>0){historyIndex--;applyPaintState(paintHistory[historyIndex]);}};
document.getElementById("redo-btn").onclick=()=>{if(historyIndex<paintHistory.length-1){historyIndex++;applyPaintState(paintHistory[historyIndex]);}};
</script>
</body>
</html>
